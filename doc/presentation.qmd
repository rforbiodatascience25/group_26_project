---
title: "Global Tuberculosis cases - WHO 2025 report\nProject Presentation - 22160 R for Bio Data Science"
authors: "Henrik (s215065), Felipe (s252623), Lun (s253705),\
Bhavya (s252641), Dhruva (s225191)"
date: "2 dec 2025"

format:
  revealjs:
    slide-number: true
    footer: ""
    css: styles.css
    code-font-size: "0.7em"
---

**1) Introduction to the data**

##### WHO Data

TB mortality and incidence (by age, sex, HIV status, risk factors, drug resistance)

Disaggregated incidence by age group, sex, and risk factors

MDR/RR-TB burden estimates

TB infection estimates in household contacts

##### Our Project Focus

------------------------------------------------------------------------

**2) Cleaning the data**

1.  Load raw WHO datasets (TB burden, age/sex, MDR/RR, LTBI).

2.  Explore data & run QC (glimpse, missingness, coverage).

3.  Remove redundant columns (iso codes, empty HIV bounds).

4.  Standardize variable names (cdr_pct, rr_incidence, Preventive_Tx).

5.  Recode categorical variables (sex, risk factors).

6.  Clean strings & metadata (age formatting, survey sources).

7.  Identify missingness patterns (Namibia, DPRK, RR gaps).

8.  Validate with checks (summaries, year structure).

9.  Save cleaned datasets (burden, age/sex, LTBI, MDR/RR).

------------------------------------------------------------------------

**3) Augmenting the data. e.g. standardardized (pr. 100k) vs normal**

::::: columns
::: {.column width="50%" style="font-size: 0.9em"}
**Joining datasets:**

```{r 3_1, echo=TRUE, eval=FALSE}
#Code for joining dataset (2024):
population_data_2024 <- TB_burden |>
  select(country, e_pop_num, year) |>
  filter(year == 2024) |>
  rename(population_size = e_pop_num)
TB_age_sex <- left_join(TB_age_sex, population_data_2024, by = c("country", "year"))
```

```{r 3_2, echo=TRUE, eval=FALSE}
#Code for joining dataset (2015-2024):
TB_10_years <- inner_join(TB_burden, mdr_rr_data, by = c("country", "year"))
TB_10_years <- inner_join(TB_10_years, ltbi_data, by = c("country", "year"))
```

![](images/04_1_top10_TB.png){width="2000"}
:::

::: {.column width="50%" style="font-size: 0.9em"}
The datasets contain TB cases for a given country. However, having a large population size (India and China), will also cause the overall TB cases to be larger for such countries.

**Solution:** Standardize the data! (I.e. amount of people with TB out of every pr. 100,000 citizen).

```{r 3_3, echo=TRUE, eval=FALSE}
#Data augmentation - Calculating the TB cases pr. 100k (standardizing the data): 
TB_age_sex <- TB_age_sex |>
  group_by(country) |>
  
  #Getting the total sum of TB cases for every country
  mutate( 
    total_TB_cases_best = sum(TB_cases_best), 
    total_TB_cases_min = sum(TB_cases_min), 
    total_TB_cases_max = sum(TB_cases_max)
    ) |> 
      #calculate the pr. 100k amount of cases
  mutate( 
        TB_cases_pr_100k_best = TB_cases_best/population_size*10^5,
        TB_cases_pr_100k_min = TB_cases_min/population_size*10^5,
        TB_cases_pr_100k_max = TB_cases_max/population_size*10^5,
        )
```

![](images/04_2_top10_TB_100k.png){width="2000"}

:::

:::::

------------------------------------------------------------------------

**4) Analysis - 2024 dataset - TB + Risk factor distribution**

::::: columns

::: {.column width="50%" style="font-size: 0.9em"}

**Bar chart - TB + Risk factor cases in the top 10 most TB burdened countries:**

``` {r 4_1, echo=TRUE, eval=FALSE}
#Code for making the plot of the TB + risk factor cases:
TB_age_sex |>
  filter(country %in% top_10_countries_100k) |>
  group_by(country, risk_factor) |>
  filter(risk_factor != "no risk factor") |>
  summarise(
    TB_cases_best = sum(TB_cases_best),
    TB_cases_min = sum(TB_cases_min),
    TB_cases_max = sum(TB_cases_max),
    population_size = first(population_size),
    TB_cases_best_100k = TB_cases_best/population_size*10^5,
    TB_cases_min_100k = TB_cases_min/population_size*10^5,
    TB_cases_max_100k = TB_cases_max/population_size*10^5,
  ) #... followed by ggplot
```

**Bar chart of the risk factor distribution:** **(Without the 'no risk factor' label)**

![](images/06_1_riskfactor_barchart.png){width="2000"}

:::


::: {.column width="50%" style="font-size: 0.9em"}

**Box plots of the global risk factor distribution:**

``` r
TB_age_sex |>
  group_by(country, risk_factor) |>
  filter(risk_factor != "no risk factor") |>
  summarise(
    TB_cases_best = sum(TB_cases_best),
    TB_cases_min = sum(TB_cases_min),
    TB_cases_max = sum(TB_cases_max),
    population_size = first(population_size),
    
    TB_cases_best_100k = TB_cases_best/population_size*10^5,
    TB_cases_min_100k = TB_cases_min/population_size*10^5,
    TB_cases_max_100k = TB_cases_max/population_size*10^5,
  ) #... followed by ggplot
```

**Box plot of TB + risk factor cases, globally:**
![](images/06_2_riskfactor_boxplot.png){width="2000"}

:::


::::: 


------------------------------------------------------------------------


**5) Analysis 2 - part 1**

(E.g. global cases)

::::: columns
::: {.column width="50%" style="font-size: 0.9em"}
test

```{r test1, echo=TRUE, eval=FALSE}
#test
```

![](placeholder_image.png)
:::

::: {.column width="50%" style="font-size: 0.9em"}
test

```{r test2, echo=TRUE, eval=FALSE}
#test
```

Another test image:

![](placeholder_image.png)
:::
:::::

------------------------------------------------------------------------

**6) Analysis 2 - part 2**

(E.g. age distribution)

------------------------------------------------------------------------

**7) Analysis 1 - part 1**

(World map plots)

------------------------------------------------------------------------

**8) Analysis 1 - part 2**

(Household contacts)

------------------------------------------------------------------------

**9) Analysis 1 - part 3**

(linear models for drug resistance and mortality in the countries. Maybe also include the stuff on detection rate).

::::: columns
::: {.column width="50%" style="font-size: 0.9em"}


```{r 5_1, echo=TRUE, eval=FALSE}
TB_10_years_joined |>
  ggplot(aes(x=(rr_incidence/e_pop_num*10^5),y=e_mort_100k, color=g_whoregion.x)) +
  geom_point(alpha = 0.45)+
  geom_smooth(method='lm', se = FALSE)+
  coord_cartesian(xlim=c(0,45), ylim=c(0,150)) +  #Eye calculated good limit for the plot
  scale_color_brewer(palette = "Set2",
    labels = labels$label,
    breaks = labels$g_whoregion.x) +
  labs(
        x = "RR - TB", 
        y = "Mortality", 
        title = "Relation between RR - TB and Mortality per region", 
        color = "WHO Region") +
  theme_minimal()
```

![](../results/05_analysis_relationship_RRTB_Mortality.png)
:::

::: {.column width="50%" style="font-size: 0.9em"}


```{r 5_2, echo=TRUE, eval=FALSE}
TB_10_years_joined |>
mutate(
disease = case_when(
  e_tbhiv_prct > mean(e_tbhiv_prct, na.rm = TRUE) & rr_new > mean(rr_new, na.rm = TRUE) ~ "HIV & RR-TB",
  e_tbhiv_prct > mean(e_tbhiv_prct, na.rm = TRUE) ~ "HIV & TB",
  rr_new > mean(rr_new, na.rm = TRUE) ~ "Only RR-TB",
  TRUE ~ "Only TB"
)) |>
ggplot(aes(x=disease, y =e_mort_100k, fill = disease))+
geom_boxplot() +
scale_fill_brewer(palette = "Set2") + 
labs(
    x = "",
    y = "Mortality cases per 100k",
    subtitle = "Mortality according to combinations of HIV and RR-TB",
    fill = "Disease"
  ) +
  theme_minimal()
```

Another test image:

![](../results/05_analysis_mortality_cases_per_100k)

:::
:::::

------------------------------------------------------------------------

**10) Conclusion/ wrapping up**

(Heatmaps and PCA for analysis 2)
